{% extends "base.html" %}
{% block title %}Edit {{ circle.circle_name }} - VibeDrop{% endblock %}

{% block content %}
<div class="topbar">
  <h1 class="page-title">Edit Sound Circle</h1>
</div>

<section class="card" style="max-width: 720px; margin-inline:auto;">
  <form method="POST" class="stack" novalidate>
    <!-- Circle name -->
    <label>
      <span class="k">Circle Name</span>
      <input class="form-control" type="text" name="circle_name" value="{{ circle.circle_name }}" required>
    </label>

    <!-- Frequency / Time -->
    <div class="form-row">
      <div>
        <label for="drop_frequency">
          <span class="k">Drop Frequency</span>
        </label>
        <select class="form-control" name="drop_frequency" id="drop_frequency" required onchange="toggleDays()">
          <option value="Daily"   {{ 'selected' if circle.drop_frequency == 'Daily'   }}>Daily</option>
          <option value="Weekly"  {{ 'selected' if circle.drop_frequency == 'Weekly'  }}>Weekly</option>
          <option value="Biweekly"{{ 'selected' if circle.drop_frequency == 'Biweekly'}}>Biweekly</option>
        </select>
      </div>

      <div>
        <label for="drop_time">
          <span class="k">Drop Time (EST)</span>
        </label>
        <select class="form-control" id="drop_time" name="drop_time" required>
          {% set current_time = circle.drop_time | to_est | datetimeformat('%I:00 %p') %}
          {% for suffix in ['AM', 'PM'] %}
            {% for hour in range(1, 13) %}
              {% set opt = '%02d:00 ' % hour ~ suffix %}
              <option value="{{ opt }}" {{ 'selected' if opt == current_time }}>
                {{ '%02d:00 ' % hour ~ suffix }} EST
              </option>
            {% endfor %}
          {% endfor %}
        </select>
        <div class="note">Times are interpreted in U.S. Eastern Time.</div>
      </div>
    </div>

    <!-- Days (conditionally shown) -->
    <div id="day1-wrap" style="display:none;">
      <label for="drop_day1">
        <span class="k">Drop Day</span>
      </label>
      <select class="form-control" name="drop_day1" id="drop_day1">
        {% for day in ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'] %}
          <option value="{{ day }}" {{ 'selected' if circle.drop_day1 == day }}>{{ day }}</option>
        {% endfor %}
      </select>
    </div>

    <div id="day2-wrap" style="display:none;">
      <label for="drop_day2">
        <span class="k">Second Drop Day</span>
      </label>
      <select class="form-control" name="drop_day2" id="drop_day2">
        {% for day in ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'] %}
          <option value="{{ day }}" {{ 'selected' if circle.drop_day2 == day }}>{{ day }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Actions -->
    <div class="row" style="justify-content:flex-start; gap:10px; margin-top:6px;">
      <a href="{{ url_for('circle_dashboard', circle_id=circle.id) }}" class="btn ghost sm">‚¨ÖÔ∏è Cancel</a>
      <button type="submit" class="btn sm">üíæ Save Changes</button>
    </div>
  </form>
</section>

<script>
  function toggleDays() {
    const freq = document.getElementById('drop_frequency').value;
    const d1 = document.getElementById('day1-wrap');
    const d2 = document.getElementById('day2-wrap');
    if (freq === 'Daily') {
      d1.style.display = 'none';
      d2.style.display = 'none';
    } else if (freq === 'Weekly') {
      d1.style.display = 'block';
      d2.style.display = 'none';
    } else { // Biweekly
      d1.style.display = 'block';
      d2.style.display = 'block';
    }
  }
  // initialize based on current value
  toggleDays();
</script>
{% endblock %}