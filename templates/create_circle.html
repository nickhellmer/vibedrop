{% extends "base.html" %}
{% block title %}Create a Sound Circle{% endblock %}

{% block extra_css %}
<style>
  /* Page-local: keep the form comfortably narrow on wide screens */
  .narrow { max-width: 720px; }
</style>
{% endblock %}

{% block content %}
<div class="topbar">
  <h1 class="page-title">Create a Sound Circle</h1>
</div>

<div class="stack">
  <section class="card narrow">
    <form method="POST" class="stack" novalidate>
      <div>
        <label for="circle_name">Circle Name</label>
        <input id="circle_name" name="circle_name" type="text" class="form-control" required maxlength="60"
               placeholder="e.g., Friday Finds, Indie Hour">
      </div>

      <div class="form-row">
        <div>
          <label for="drop_frequency">Drop Frequency</label>
          <select id="drop_frequency" name="drop_frequency" class="form-control" required>
            <option value="">— Select —</option>
            <option value="Daily">Daily</option>
            <option value="Weekly">Weekly</option>
            <option value="Biweekly">Biweekly</option>
          </select>
          <div class="help">Choose how often your Sound Circle drops new vibes.</div>
        </div>

        <div>
          <label for="drop_time">Drop Time <span class="subtle">(EST)</span></label>
          <select id="drop_time" name="drop_time" class="form-control" required>
            {% for suffix in ['AM','PM'] %}
              {% for hour in range(1,13) %}
                <option value="{{ '%02d:00 %s' % (hour, suffix) }}">{{ '%02d:00 %s EST' % (hour, suffix) }}</option>
              {% endfor %}
            {% endfor %}
          </select>
          <div class="help">All times are stored in EST for now.</div>
        </div>
      </div>

      <div id="day1_group" style="display:none;">
        <label for="drop_day1">Drop Day</label>
        <select id="drop_day1" name="drop_day1" class="form-control">
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
        </select>
      </div>

      <div id="day2_group" style="display:none;">
        <label for="drop_day2">Second Drop Day</label>
        <select id="drop_day2" name="drop_day2" class="form-control">
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
        </select>
        <div class="help">Shown only for Biweekly circles.</div>
      </div>

      <div class="row" style="margin-top:6px;">
        <button type="submit" class="btn sm">Create</button>
      </div>
    </form>
  </section>
  <a class="btn link" href="{{ url_for('dashboard') }}">⬅️ Back to Profile</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Show/hide day fields based on frequency selection
  function updateDropFields() {
    const frequency = document.getElementById("drop_frequency").value;
    const day1 = document.getElementById("day1_group");
    const day2 = document.getElementById("day2_group");

    if (frequency === "Daily") {
      day1.style.display = "none";
      day2.style.display = "none";
    } else if (frequency === "Weekly") {
      day1.style.display = "block";
      day2.style.display = "none";
    } else if (frequency === "Biweekly") {
      day1.style.display = "block";
      day2.style.display = "block";
    } else {
      day1.style.display = "none";
      day2.style.display = "none";
    }
  }

  // Initialize state on load + bind change listener
  document.addEventListener('DOMContentLoaded', function(){
    const select = document.getElementById("drop_frequency");
    if (select) {
      select.addEventListener('change', updateDropFields);
      updateDropFields(); // run once to set default visibility
    }
  });
</script>
{% endblock %}