<!DOCTYPE html>
<html lang="en">
<head>
  {% set current_year = current_year or 2025 %}
  <meta charset="UTF-8">
  <title>{% block title %}VibeDrop{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;600&display=swap" rel="stylesheet">

  <style>
    /* ================================
       Design Tokens (VibeDrop Rustic)
    ===================================*/
    :root{
      --bg:#121212;               /* charcoal */
      --panel:#1a1a1a;            /* deep slate */
      --text:#F3E8D0;             /* cream */
      --muted:#BFB7A6;            /* sand */
      --brand:#7A5C99;            /* rustic purple for links, accents */
      --brand-hover:#E85B32;
      --brand-ghost: #7a5c9922;

      /* NEW: CTA button color (teal from logo) */
      --cta:#0FA3B1;              /* deep teal */
      --cta-hover:#0C8E9A;
      --cta-ghost: rgba(15,163,177,.14);
      
      --danger:#ff4d4f;
      --success:#20c997;
      --warning:#f59f00;
      --radius:14px;
      --gap:20px;
      --shadow:0 6px 28px rgba(0,0,0,.35);
      --border:#232633;           /* cool outline */
      --ink:#0b0d12;              /* darkest */
      --table:#0f1218;            /* table bg */
      --table-head:#1b2030;       /* table head bg */
      --chip:#11151d;             /* chip bg */
    }

    *{ box-sizing:border-box }
    html, body{ height:100% }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:'Space Grotesk',sans-serif;
    }
    a{ color:var(--brand); text-decoration:none }
    a:hover{ text-decoration:underline }

    /* ================================
       Layout
    ===================================*/
    main{ padding:40px 20px; }
    .container{ max-width:1100px; margin:0 auto; }
    .stack{ display:flex; flex-direction:column; gap:16px }
    .row{ display:flex; flex-wrap:wrap; align-items:center; gap:12px }

    /* Topbar & Titles */
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px; }
    .page-title{ margin:0; font-weight:600; color:var(--brand); font-size:2.2rem; }
    .subtle{ color:var(--muted) }
    .h2-tight{ margin:0 0 8px 0; font-size:1.35rem; }

    /* ================================
       Cards
    ===================================*/
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px;
    }

    /* ================================
       Lightweight Utilities
    ===================================*/
    .meta-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap:12px 16px;
    }
    .kv{ display:flex; flex-direction:column; gap:3px; }
    .kv .k{ font-size:.8rem; color:var(--muted); text-transform:uppercase; letter-spacing:.04em; }
    .kv .v{ font-size:1.05rem; }
    .chip{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--chip);
      font-size:.9rem;
      color:var(--text);
    }
    .code-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:10px;
      border:1px dashed var(--border);
      background:var(--chip);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:.95rem;
      color:var(--text);
    }
    .divider{height:1px; background:var(--border); margin:12px 0;}
    .between{ justify-content:space-between; }
    .nowrap{ white-space:nowrap; }
    .code-pill.flash {
      border-color: var(--brand) !important;
      box-shadow: 0 0 0 2px var(--brand-ghost);
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    .action-row{ display:flex; align-items:center; gap:6px; }
    .mt-10{ margin-top:10px; }
    .note {font-size: .85rem; color: var(--muted); font-style: italic;}

    /* ================================
       Buttons
    ===================================*/
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      background:var(--cta); color:#071a1c;           /* slightly warm ink for contrast */
      border:0; border-radius:12px;
      padding:12px 18px; font-weight:700; cursor:pointer;
      font-size:.95rem; line-height:1;
      font-family:'Space Grotesk',sans-serif;
      transition:transform .04s ease, opacity .15s ease, background .15s ease, box-shadow .15s ease;
      box-shadow: 0 0 0 0 rgba(255,106,61,0);
    }
    .btn:hover{ background:var(--cta-hover); box-shadow:0 6px 16px var(--cta-ghost) }
    .btn:active{ transform:translateY(1px) }
    .btn:disabled{ opacity:.55; cursor:not-allowed }

    /* Ghost (brand outline) */
    .btn.ghost{ background:transparent; color:var(--brand); border:1px solid var(--brand); }
    .btn.ghost:hover{ background:var(--brand-ghost); }

    /* Ghost Danger */
    .btn.ghost.danger{ background: #694D82; border: 1px solid var(--danger); color: var(--danger) }
    .btn.ghost.danger:hover{ background: rgba(255,77,79,0.1) }

    /* Sizes */
    .btn.xs{ padding:2px 4px; font-size:.75rem; border-radius:10px }
    .btn.sm{ padding:8px 12px; font-size:.9rem; border-radius:10px }
    .btn.lg{ padding:14px 22px; font-size:1.05rem; border-radius:14px }
    .btn.equal{ min-width:160px; min-height: 30px; text-align:center }

    /* Icon buttons */
    .icon-button{
      display:inline-flex; align-items:center; justify-content:center;
      width:40px; height:40px; border-radius:999px;
      background:#1a1f2b; border:1px solid var(--border); color:var(--text);
      cursor:pointer; transition:background .15s ease, border-color .15s ease, transform .04s ease;
    }
    .icon-button.sm{ width:28px; height:28px; font-size:.9rem; }
    .icon-button:hover{ background:#182135 }
    .icon-button:active{ transform:translateY(1px) }
    .icon-button.active{ border-color:var(--brand); box-shadow:0 0 0 2px var(--brand-ghost) inset; }

    /* Link-style button */
    .btn.link { background: none; border: none; color: var(--brand); font-weight: 700; padding: 0; margin: 0; cursor: pointer; }
    .btn.link:hover { text-decoration: underline; background: none; }

    /* ================================
       Tables
    ===================================*/
    table.table{ width:100%; border-collapse:separate; border-spacing:0; background:var(--table); }
    .table th, .table td { padding: 6px 10px; vertical-align: middle; }
    .table-viewport{
      position: relative;
      max-height: 420px;
      overflow: auto;
      border-radius: 12px;
      background:var(--table);
      border:1px solid var(--border);
      -webkit-overflow-scrolling: touch;
    }
    .table-viewport .table{ margin:0; }
    .table thead th{
      background:var(--table-head); color:var(--muted);
      font-weight:600; text-align:left; padding:6px 10px;
      border-bottom:1px solid var(--border);
      position: sticky; top: 0; z-index: 1;
    }
    .table tbody td{ border-top:1px solid var(--border) }
    .table tbody tr:hover{ background:#141927 }
    .col-narrow{ width:1%; white-space:nowrap }
    .col-wide{ width:40% }
    .actions-cell{ display:flex; align-items:center; justify-content:center; gap:8px }
    .nowrap{ white-space:nowrap; }
    .table--compact thead th{ padding:4px 8px; font-size:.95rem; }
    .table--compact tbody td{ padding:4px 8px; font-size:.95rem; }
    .truncate{
      display:inline-block;
      max-width: 420px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .table.sortable thead th { cursor: pointer; user-select: none; }
    .table.sortable thead th .sort-ind { opacity:.55; margin-left:6px; font-size:.9em; }
    .table.sortable thead th.active .sort-ind { opacity:1; }

    /* ================================
       Responsive/adaptive Table and Card Height Utilities
    ===================================*/
    .card.flex {display: flex; flex-direction: column }
    .grow {flex: 1 1 auto }
    .table-viewport.flex {
      flex: 1 1 auto;
      min-height: 220px;
      max-height: calc(100vh - 260px);
      overflow: auto;
    }

    /* ================================
       Forms
    ===================================*/
    label{ display:block; margin-bottom:6px; color:var(--muted) }
    .form-control{
      width:100%; background:#121623; color:var(--text);
      border:1px solid var(--border); border-radius:12px; padding:10px 12px;
      font-family:'Space Grotesk',sans-serif;
    }
    select.form-control{ appearance:none; background-image: none; }
    .help{ color:var(--muted); font-size:.9rem; margin-top:6px }
    .form-row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .form-row.cols-3{ grid-template-columns:1fr 1fr 1fr }

    /* ================================
       Flash messages
    ===================================*/
    .flash-message{
      background-color:#141927;
      border:1px solid var(--brand);
      color:var(--text);
      padding:8px 12px;
      margin:12px auto;
      border-radius:8px;
      width:65%;
      max-width:320px;
      text-align:center;
      font-size:.85rem;
      line-height:1.2;
      opacity:1;
      transition:opacity .5s ease;
      box-shadow:0 8px 22px rgba(0,0,0,.25);
    }
    .flash-message.success{ border-color:var(--success) }
    .flash-message.error{ border-color:var(--danger) }
    .flash-message.info{ border-color:var(--brand) }

    /* ================================
       Badges
    ===================================*/
    .badge{
      display:inline-block; padding:4px 8px; border-radius:999px;
      font-size:.85rem; line-height:1; border:1px solid var(--border); background:#121623; color:var(--muted);
    }
    .badge.success{ border-color:var(--success); color:var(--success) }
    .badge.warning{ border-color:var(--warning); color:var(--warning) }
    .badge.info{ border-color:var(--brand); color:var(--brand) }

    /* ================================
       Monogram (kept for legacy pages)
    ===================================*/
    .monogram{ position:relative; width:40px; height:40px; }
    .monogram span{
      position:absolute; font-size:40px;
      -webkit-text-stroke:1.5px var(--brand); text-stroke:1.5px var(--brand); line-height:1; color:var(--text);
    }
    .v-left{ top:-9px; left:4px; clip-path:inset(0 12px 0 0); z-index:2 }
    .v-right{ top:-9px; left:4px; clip-path:inset(0 0 0 12px); z-index:0 }
    .d{ top:8px; left:3px; transform:rotate(18deg); color:var(--brand); -webkit-text-stroke:1.5px var(--text); text-stroke:1.5px var(--text); z-index:1 }

    /* ================================
       Global Mobile Overrides
    ===================================*/
    @media (max-width: 768px){
      main{ padding:22px 14px }
      .page-title { font-size:1.4rem; max-width: 90%; }
      .btn{ padding:10px 14px; font-size:.95rem }
      .btn.lg{ padding:12px 18px; font-size:1rem }
      .icon-button{ width:36px; height:36px }
      .table-viewport{ max-height: 50vh; }
      .table-viewport.flex { min-height: 180px; }
      .form-row, .form-row.cols-3{ grid-template-columns:1fr }
      .actions-cell{ gap:6px }
      .truncate{ max-width: 220px; }
      .table thead th{ font-size: .95rem; }
      .table tbody td{ font-size: .95rem; }
      .meta-grid{ grid-template-columns: 1fr 1fr; }
      .row { gap:10px; }
      .btn.equal{ min-width:140px; }
    }
  </style>

  {% block extra_css %}{% endblock %}
</head>
<body>

  {% include 'sidebar.html' %}

  <main>
    <div id="flash-container" class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>

    <div class="container">
      {% block content %}{% endblock %}
    </div>
  </main>

  <script>
    setTimeout(() => {
      const flashes = document.querySelectorAll('.flash-message');
      flashes.forEach(flash => {
        flash.style.opacity = 0;
        setTimeout(() => flash.remove(), 500);
      });
    }, 4000);
  </script>

  <script>
    (function(){
      function getCellVal(td, type) {
        const v = td.getAttribute('data-sort') ?? td.textContent.trim();
        if (type === 'number') return parseFloat(v.replace(/[^0-9.\-]/g,'')) || 0;
        if (type === 'date')   return Date.parse(v) || 0;
        return v.toLowerCase();
      }
      function sortTable(table, colIdx, type, dir){
        const tbody = table.tBodies[0];
        const rows = Array.from(tbody.rows);
        rows.sort((a,b)=>{
          const va = getCellVal(a.cells[colIdx], type);
          const vb = getCellVal(b.cells[colIdx], type);
          if (va < vb) return dir==='asc' ? -1 : 1;
          if (va > vb) return dir==='asc' ? 1 : -1;
          return 0;
        });
        rows.forEach(r=>tbody.appendChild(r));
      }
      function initSortable(table){
        const ths = Array.from(table.tHead?.rows[0]?.cells ?? []);
        ths.forEach((th, i)=>{
          const type = th.getAttribute('data-type') || 'text';
          let dir = 'asc';
          if (!th.querySelector('.sort-ind')){
            const s = document.createElement('span');
            s.className = 'sort-ind';
            s.textContent = '↕';
            th.appendChild(s);
          }
          th.addEventListener('click', ()=>{
            ths.forEach(x=>x.classList.remove('active'));
            th.classList.add('active');
            sortTable(table, i, type, dir);
            th.querySelector('.sort-ind').textContent = (dir==='asc'?'↑':'↓');
            dir = (dir==='asc' ? 'desc' : 'asc');
          });
        });
      }
      document.addEventListener('DOMContentLoaded', ()=>{
        document.querySelectorAll('table.table.sortable').forEach(initSortable);
        document.querySelectorAll('[data-created]').forEach(td=>{
          const iso = td.getAttribute('data-created'); if(!iso) return;
          const t = Date.parse(iso); if(!t) return;
          const ms = Date.now() - t;
          const day = 86400000, week = 7*day, month = 30*day, year = 365*day;
          let text;
          if (ms < 14*day)       text = Math.max(1, Math.round(ms/day)) + ' day'   + (ms>=2*day?'s':'');
          else if (ms < 9*week)  text = Math.round(ms/week)             + ' week'  + (ms>=2*week?'s':'');
          else if (ms < 24*month)text = Math.round(ms/month)            + ' month' + (ms>=2*month?'s':'');
          else                   text = Math.round(ms/year)             + ' year'  + (ms>=2*year?'s':'');
          td.textContent = text;
          td.setAttribute('data-sort', String(t));
        });
      });
    })();
  </script>

  {% block extra_js %}{% endblock %}

  <footer style="margin-top: 40px; padding: 20px; text-align: center; font-size: 0.9rem;
      color: var(--muted); border-top: 1px solid var(--border); background-color: var(--panel);">
    <div class="container">
      <span>&copy; {{ current_year }} VibeDrop</span> &nbsp;|&nbsp;
      <a href="{{ url_for('privacy') }}">Privacy Policy</a> &nbsp;|&nbsp;
      <a href="{{ url_for('terms') }}">Terms of Service</a>
    </div>
  </footer>
</body>
</html>