{% extends "base.html" %}
{% block title %}VibeDrop Dashboard{% endblock %}

{% block content %}

<!-- Page title -->
<div class="topbar">
  <h1 class="page-title">ðŸŽ§ Welcome, {{ user.vibedrop_username }}!</h1>
</div>

<!-- Drop Cred card -->
<section class="card">
  <div class="stat">
    <div class="stat-label">Drop Cred</div>
    <div class="stat-value">{{ drop_cred }}</div>
    <div class="note">Scale 1â€“10 â€¢ Phase 1 (MVP)</div>
  </div>
</section>

<!-- Your Sound Circles -->
<section class="card flex">
  <h2 class="h2-tight">Your Sound Circles</h2>

  <div class="table-viewport flex grow">
    <table class="table table--compact sortable">
      <thead>
        <tr>
          <th data-type="text">Circle Name</th>
          <th class="col-narrow" data-type="number">Members</th>
          <th class="col-narrow" data-type="text">Frequency</th>
          <th class="col-narrow" data-type="text">Drop Day</th>
          <th class="col-narrow" data-type="date">Lifetime</th>
        </tr>
      </thead>
      <tbody>
        {% for circle in circles %}
        {% set freq = circle.drop_frequency %}
        {% set drop_display = '-' %}
        {% if freq == 'Weekly' %}
          {% set drop_display = circle.drop_day1 %}
        {% elif freq == 'Biweekly' %}
          {% set drop_display = circle.drop_day1 ~ ' & ' ~ circle.drop_day2 %}
        {% elif freq == 'Daily' %}
          {% set drop_display = '-' %}
        {% endif %}
        <tr>
          <td>
            <a href="{{ url_for('circle_dashboard', circle_id=circle.id) }}">
              <span class="truncate">{{ circle.circle_name }}</span>
            </a>
          </td>

          <!-- numeric sort via data-sort -->
          <td class="nowrap" data-sort="{{ circle.members|length }}">{{ circle.members|length }}</td>

          <td class="nowrap">{{ freq }}</td>
          <td class="nowrap">{{ drop_display }}</td>

          <!-- lifetime: JS will fill text and provide sort key; we pass ISO timestamp -->
          <td class="nowrap"
              data-created="{{ circle.created_at.isoformat() if circle.created_at else '' }}">
            <!-- JS fills this with "X days/weeks/months/years" -->
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Actions -->
  <div class="row" style="margin-top:12px;">
    <form action="{{ url_for('create_circle') }}" method="GET">
      <button type="submit" class="btn sm equal">âž• Create Sound Circle</button>
    </form>
    <form action="{{ url_for('join_circle') }}" method="GET">
      <button type="submit" class="btn sm equal">ðŸ”— Join Sound Circle</button>
    </form>
  </div>
</section>

{% endblock %}
